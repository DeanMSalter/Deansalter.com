<script src="https://apis.google.com/js/platform.js" async defer></script>
<meta name="google-signin-client_id" content="178845838452-48f1cmbdoksqrgsi6djimbqceg2ppqsv.apps.googleusercontent.com">

<nav role="navigation">
    <div class="navList">
        <ul>
            <li id="homeNavEntry"><a href="../index.html">CV</a></li>
            <li id="projectsNavEntry"><a href="../projects/index.html" target="_blank">Projects</a></li>
            <li id="notesNavEntry"><a href="../notes/index.html">Notes</a></li>
            <li id="linkedinNavEntry"><a href="https://www.linkedin.com/in/dean-salter" target="_blank">Linkedin</a></li>
            <li id="gitHubNavEntry"><a href="https://github.com/DeanMSalter" target="_blank">Github</a></li>
            <li id="signInBtnLI">
                <div class="g-signin2" id="signInBtn" data-onsuccess="onSignIn"></div>
                <img src="" id="signedInProfilePic" alt="profile picture">
                <input type="button" id="signOutBtn" onclick="javascript:signOut()" value="sign out">
            </li>
        </ul>
    </div>
</nav>
<template id="navActiveImgTemplate">
    <img id="navActiveImg" src="../imgs/hollowBall.png">
</template>

<script>

    function onSignIn(googleUser) {
        let profile = googleUser.getBasicProfile();
        localStorage.setItem('idToken', googleUser.getAuthResponse().id_token);
        // console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
        // console.log('IDToken: ' + googleUser.getAuthResponse().id_token); // Do not send to your backend! Use an ID token instead.
        //
        // console.log('Name: ' + profile.getName());
        // console.log('Image URL: ' + profile.getImageUrl());
        // console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
        let signedInProfilePic = $("#signedInProfilePic");
        signedInProfilePic.attr("src",profile.getImageUrl());
        signedInProfilePic.css("height",$("#signInBtn").css("height"));
        signedInProfilePic.css("display","inline-block");
        $("#signInBtn").css("display","none");
        $("#signOutBtn").css("display","inline-block");
        $.ajax({
            url:"../proccessLogin.php ",
            method:"POST",
            data:{
                idToken: googleUser.getAuthResponse().id_token, // Second add quotes on the value.
            },
            success:function(response) {
                console.log(response)
            },
            error:function(){
                //TODO: better error message
                alert("error");
            }

        });
    }
    function signOut() {
        let signedInProfilePic = $("#signedInProfilePic");
        let auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
            console.log('User signed out.');
            localStorage.removeItem('idToken');
            signedInProfilePic.css("display","none");
            $("#signInBtn").css("display","inline-block");
            $("#signOutBtn").css("display","none");


        });
    }
</script>